<!DOCTYPE html>
<html>
<head>
<style>
    h2 { color: #2c3e50; border-bottom: 1px solid #eee; padding-bottom: 5px; }
    h3 { color: #e67e22; margin-top: 15px; margin-bottom: 5px; }
    li { margin-bottom: 5px; }
    strong { color: #c0392b; }
    .highlight { background-color: #f9f9f9; padding: 2px; border-radius: 3px; }
</style>
</head>
<body>

<h1>🚀 项目迭代报告：曲线与曲面生成算法的实现 (v4.3)</h1>

<p><b>项目名称:</b> ShapePainter v4.3 (Assignment Phase 3)<br>
<b>核心目标:</b> 在原有光栅化系统的基础上，攻克“参数曲线”与“参数曲面”的底层生成算法，并对交互系统进行工业级重构（全面浮点化 + OBB变换）。</p>

<hr>

<h2>一、 核心进化：技术维度对比</h2>
<p>本次迭代（第三次作业）的重点在于数学与算法的深度升级。我们不再局限于简单的直线和圆，而是进入了自由曲线和曲面的领域。</p>

<h3>1. 曲线算法升级</h3>
<ul>
    <li><b>[旧版本]:</b> 仅支持直线、圆、椭圆等基本图元。</li>
    <li><b>[新版本]:</b> 新增 <strong>双参数曲线引擎</strong>。
        <ul>
            <li>贝塞尔曲线 (Bézier): 基于 Bernstein 基函数与 de Casteljau 算法。</li>
            <li>B样条曲线 (B-Spline): 基于 Cox-de Boor 递归公式。</li>
            <li><span class="highlight">亮点: 实现了自适应阶数 (Adaptive Degree)，点少时自动降级，防止崩坏。</span></li>
        </ul>
    </li>
</ul>

<h3>2. 曲面算法升级 (本次重点)</h3>
<ul>
    <li><b>[旧版本]:</b> 无。</li>
    <li><b>[新版本]:</b> 新增 <strong>双三次贝塞尔曲面 (Bicubic Bézier Surface)</strong>。
        <ul>
            <li>原理: 基于张量积 (Tensor Product)，通过 4x4 控制网格定义。</li>
            <li>可视化: 支持 "网格显示" (Wireframe) 和 "曲面填充" (Surface Fill) 双模式叠加。</li>
            <li><span class="highlight">亮点: 手动实现了 Gouraud Shading 着色引擎，通过 DDA 扫描线同步插值坐标与颜色。</span></li>
        </ul>
    </li>
</ul>

<h3>3. 坐标精度重构</h3>
<ul>
    <li><b>[旧版本]:</b> 整数坐标 (int)。缩放/旋转多次后会出现“漂移”和抖动。</li>
    <li><b>[新版本]:</b> <strong>全面浮点化 (float)</strong>。
        <ul>
            <li>底层数据结构全面升级为 QPointF / QRectF。</li>
            <li><span class="highlight">亮点: 彻底消除了多次变换后的精度累积误差，缩放操作丝般顺滑。</span></li>
        </ul>
    </li>
</ul>

<h3>4. 交互逻辑重构</h3>
<ul>
    <li><b>[旧版本]:</b> AABB (轴对齐包围盒)。旋转后，缩放框依然是水平的，操作反直觉。</li>
    <li><b>[新版本]:</b> <strong>OBB (有向包围盒)</strong>。
        <ul>
            <li>变换框随图形旋转。</li>
            <li><span class="highlight">亮点: 实现了动态光标系统，光标随旋转角度实时转动，实现“所见即所得”。</span></li>
        </ul>
    </li>
</ul>

<h3>5. 渲染架构优化</h3>
<ul>
    <li><b>[旧版本]:</b> 逐像素绘制 (setPixel)，大面积填充时卡顿。</li>
    <li><b>[新版本]:</b> <strong>Scanline Spans (扫描线段)</strong>。
        <ul>
            <li>算法层输出线段流，批量提交 GPU。</li>
            <li><span class="highlight">亮点: 结合图层脏矩形 (Dirty Rect) 缓存机制，Python 软渲染也能跑满 60FPS。</span></li>
        </ul>
    </li>
</ul>

<hr>

<h2>二、 严格对照作业要求</h2>
<p>本项目严格遵循作业要求，所有核心功能均<b>未调用图形库高级接口</b>，而是通过 <code>raster_algorithms.py</code> 原生实现。</p>

<ul>
    <li>✅ <b>至少手动实现两种经典参数曲线算法:</b>
        <br>实现了 Path (贝塞尔) 和 BSpline (B样条) 类。算法核心位于 raster_algorithms.py。
    </li>
    <li>✅ <b>实现至少一种参数曲面算法:</b>
        <br>实现了双三次贝塞尔曲面。支持通过 4x4 控制网格定义，支持 Gouraud 颜色插值。
    </li>
    <li>✅ <b>新增曲线曲面平移/旋转/缩放操作:</b>
        <br>重构了交互逻辑，升级为 OBB。修复了旋转后的缩放中心漂移问题。
    </li>
    <li>✅ <b>系统特色与人机交互:</b>
        <br>专业级标尺（文字竖排）、精密网格（Cosmetic Pen）、参考线拖拽系统、动态旋转光标。
    </li>
</ul>

<hr>

<h2>三、 总结</h2>
<p>本次迭代不仅完成了作业规定的算法实现，更是在<b>工程质量</b>上通过了巨大的挑战。我们解决了浮点精度丢失、OBB 交互数学逻辑、Gouraud 插值效率等多个图形学开发中的深水区问题。最终交付的是一个算法底层纯粹、交互体验流畅、功能完备的绘图系统。</p>

</body>
</html>